/*! hapify-cli 2019-03-03 */

"use strict";var __decorate=this&&this.__decorate||function(t,e,i,a){var r,o=arguments.length,s=o<3?e:null===a?a=Object.getOwnPropertyDescriptor(e,i):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,a);else for(var l=t.length-1;l>=0;l--)(r=t[l])&&(s=(o<3?r(s):o>3?r(e,i,s):r(e,i))||s);return o>3&&s&&Object.defineProperty(e,i,s),s},__metadata=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},__importStar=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e},__importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0});const typedi_1=require("typedi"),Path=__importStar(require("path")),Fs=__importStar(require("fs")),Os=__importStar(require("os")),mkdirp_1=__importDefault(require("mkdirp")),Joi=__importStar(require("joi")),interface_1=require("../interface");let GlobalConfigService=class{constructor(){this.rootPath=Path.resolve(Os.homedir(),".hapify"),this.filename="config.json",this.filePath=Path.join(this.rootPath,this.filename),this.data={},this.init()}init(){Fs.existsSync(this.rootPath)&&Fs.statSync(this.rootPath).isDirectory()||mkdirp_1.default.sync(this.rootPath),Fs.existsSync(this.filePath)&&Fs.statSync(this.filePath).isFile()||this.save(),this.load(),this.validate()}save(){Fs.writeFileSync(this.filePath,JSON.stringify(this.data,null,4),"utf8")}load(){this.data=JSON.parse(Fs.readFileSync(this.filePath,"utf8"))}validate(t=this.data){const e=Joi.validate(t,interface_1.GlobalConfigSchema);if(e.error){const t=e.error.details.map(t=>t.message).join(", ");throw new Error(`Global config format error: ${t}.`)}}getData(){return this.data}setData(t){this.validate(t),this.data=t,this.save()}};GlobalConfigService=__decorate([typedi_1.Service(),__metadata("design:paramtypes",[])],GlobalConfigService),exports.GlobalConfigService=GlobalConfigService;