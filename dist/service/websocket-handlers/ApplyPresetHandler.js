/*! hapify-cli 2019-05-28 */

"use strict";var __decorate=this&&this.__decorate||function(e,t,r,a){var i,n=arguments.length,c=n<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,r):a;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,r,a);else for(var o=e.length-1;o>=0;o--)(i=e[o])&&(c=(n<3?i(c):n>3?i(t,r,c):i(t,r))||c);return n>3&&c&&Object.defineProperty(t,r,c),c},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},__awaiter=this&&this.__awaiter||function(e,t,r,a){return new(r||(r=Promise))(function(i,n){function c(e){try{s(a.next(e))}catch(e){n(e)}}function o(e){try{s(a.throw(e))}catch(e){n(e)}}function s(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(c,o)}s((a=a.apply(e,t||[])).next())})},__importStar=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t};Object.defineProperty(exports,"__esModule",{value:!0});const typedi_1=require("typedi"),interface_1=require("../../interface"),Presets_1=require("../Presets"),Joi=__importStar(require("joi")),class_1=require("../../class");let ApplyPresetHandlerService=class{constructor(e){this.presetsService=e}canHandle(e){return e.id===interface_1.WebSocketMessages.APPLY_PRESETS}validator(){return Joi.object({models:Joi.array().items(interface_1.ModelSchema).required().min(0)})}handle(e){return __awaiter(this,void 0,void 0,function*(){const t=e.data.models.map(e=>new class_1.Model(e)),r=yield this.presetsService.apply(t);return{updated:r.updated.map(e=>e.toObject()),created:r.created.map(e=>e.toObject())}})}};ApplyPresetHandlerService=__decorate([typedi_1.Service(),__metadata("design:paramtypes",[Presets_1.PresetsService])],ApplyPresetHandlerService),exports.ApplyPresetHandlerService=ApplyPresetHandlerService;