/*! hapify-cli 2019-03-06 */

"use strict";var __awaiter=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(a,i){function o(e){try{p(r.next(e))}catch(e){i(e)}}function s(e){try{p(r.throw(e))}catch(e){i(e)}}function p(e){e.done?a(e.value):new n(function(t){t(e.value)}).then(o,s)}p((r=r.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const enum_1=require("../enum"),typedi_1=require("typedi"),service_1=require("../service");class Template{constructor(e,t){this.parent=e,this.storageService=typedi_1.Container.get(service_1.TemplatesFileStorageService),t&&this.fromObject(t)}fromObject(e){return this.path=e.path,this.engine=e.engine,this.input=e.input,this.content=e.content,this.contentPath=Template.computeContentPath(this),this}toObject(){return{path:this.path,engine:this.engine,input:this.input,content:this.content}}isEmpty(){return"string"!=typeof this.content||0===this.content.trim().length}needsModel(){return this.input===enum_1.TemplateInput.One}extension(){return Template.computeExtension(this)}channel(){return this.parent}load(){return __awaiter(this,void 0,void 0,function*(){yield this.validate(),this.content=yield this.storageService.get([this.parent.templatesPath,this.contentPath])})}save(){return __awaiter(this,void 0,void 0,function*(){yield this.storageService.set([this.parent.templatesPath,this.contentPath],this.content)})}validate(){return __awaiter(this,void 0,void 0,function*(){if(!(yield this.storageService.exists([this.parent.templatesPath,this.contentPath])))throw new Error(`Template's path ${this.parent.templatesPath}/${this.contentPath} does not exists.`)})}static computeContentPath(e){const t=typedi_1.Container.get(service_1.StringService);return`${e.path.replace(/{model\.hyphen}/g,t.format(Template.defaultFolder,enum_1.SentenceFormat.SlugHyphen)).replace(/{model\.hyphenUpper}/g,t.format(Template.defaultFolder,enum_1.SentenceFormat.SlugHyphenUpperCase)).replace(/{model\.underscore}/g,t.format(Template.defaultFolder,enum_1.SentenceFormat.SlugUnderscore)).replace(/{model\.underscoreUpper}/g,t.format(Template.defaultFolder,enum_1.SentenceFormat.SlugUnderscoreUpperCase)).replace(/{model\.oneWord}/g,t.format(Template.defaultFolder,enum_1.SentenceFormat.SlugOneWord)).replace(/{model\.upperCamel}/g,t.format(Template.defaultFolder,enum_1.SentenceFormat.UpperCamelCase)).replace(/{model\.lowerCamel}/g,t.format(Template.defaultFolder,enum_1.SentenceFormat.LowerCamelCase))}.${Template.computeExtension(e)}`}static computeExtension(e){return e.engine===enum_1.TemplateEngine.Hpf?"hpf":"js"}}Template.defaultFolder="model",exports.Template=Template;